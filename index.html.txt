<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>80s Dice Final Fix</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        
        .container { width: 150px; height: 150px; perspective: 1000px; margin-bottom: 80px; }
        
        #dice { 
            width: 100%; height: 100%; position: relative; 
            transform-style: preserve-3d; 
            transform: rotateX(-20deg) rotateY(20deg);
        }

        .side {
            position: absolute; width: 150px; height: 150px; 
            background: #ffffff; border: 5px solid #00ffff;
            display: flex; align-items: center; justify-content: center;
            font-size: 80px; font-weight: bold; color: #000;
            box-shadow: 0 0 15px #00ffff; border-radius: 10px;
            backface-visibility: visible;
        }

        /* Würfel-Geometrie Definition */
        .sFront  { transform: rotateY(0deg) translateZ(75px); }
        .sBack   { transform: rotateY(180deg) translateZ(75px); }
        .sRight  { transform: rotateY(90deg) translateZ(75px); }
        .sLeft   { transform: rotateY(-90deg) translateZ(75px); }
        .sTop    { transform: rotateX(90deg) translateZ(75px); }
        .sBottom { transform: rotateX(-90deg) translateZ(75px); }

        button {
            padding: 25px 50px; font-size: 30px; background: #ff00ff;
            color: white; border: 4px solid #00ffff; border-radius: 15px;
            box-shadow: 0 0 20px #ff00ff; font-weight: bold; cursor: pointer;
            text-transform: uppercase;
        }
    </style>
</head>
<body>

<div class="container">
    <div id="dice">
        <div class="side sFront">1</div>
        <div class="side sBack">6</div>
        <div class="side sRight">2</div>
        <div class="side sLeft">5</div>
        <div class="side sTop">3</div>
        <div class="side sBottom">4</div>
    </div>
</div>

<button onclick="roll()">GO</button>

<script>
    function playBeep() {
        try {
            const context = new (window.AudioContext || window.webkitAudioContext)();
            const osc = context.createOscillator();
            const gain = context.createGain();
            osc.type = 'square';
            osc.frequency.setValueAtTime(150, context.currentTime);
            gain.gain.setValueAtTime(0.1, context.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.1);
            osc.connect(gain);
            gain.connect(context.destination);
            osc.start();
            osc.stop(context.currentTime + 0.1);
        } catch(e) {}
    }

    function roll() {
        const d = document.getElementById('dice');
        
        // 1. Zufälliges Ergebnis festlegen
        const result = Math.floor(Math.random() * 6);
        
        // 2. Ziel-Rotationen passend zu den CSS-Klassen
        const targets = [
            {x: 0, y: 0},          // 1 (Front)
            {x: 0, y: 180},        // 6 (Back)
            {x: 0, y: -90},        // 2 (Right)
            {x: 0, y: 90},         // 5 (Left)
            {x: -90, y: 0},        // 3 (Top)
            {x: 90, y: 0}          // 4 (Bottom)
        ];
        
        const target = targets[result];
        
        // 3. Volle Drehungen (4-6 Runden) für den Effekt
        const roundsX = (Math.floor(Math.random() * 3) + 4) * 360;
        const roundsY = (Math.floor(Math.random() * 3) + 4) * 360;
        
        const finalX = roundsX + target.x;
        const finalY = roundsY + target.y;
        
        // 4. Animation starten (Cubic-Bezier für sanftes Bremsen)
        d.style.transition = "transform 1.5s cubic-bezier(0.15, 0, 0.15, 1)";
        d.style.transform = `rotateX(${finalX}deg) rotateY(${finalY}deg)`;

        // 5. Sound nach der Drehung
        setTimeout(() => {
            playBeep();
            
            // Werte normalisieren, damit beim nächsten Klick kein Sprung passiert
            setTimeout(() => {
                d.style.transition = "none";
                d.style.transform = `rotateX(${target.x}deg) rotateY(${target.y}deg)`;
            }, 1550);
            
        }, 1450); 
    }
</script>
</body>
</html>